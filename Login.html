<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>SGI ‚Äì Ingreso al Sistema</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body, html {
        height: 100%;
        overflow: hidden;
        font-family: 'Segoe UI', sans-serif;
    }

    /* VIDEO DE FONDO */
    #videoBG {
        position: fixed;
        top: 0; left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: -2;
    }

    .overlay-dark {
        position: fixed;
        top: 0; left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.45);
        backdrop-filter: blur(2px);
        z-index: -1;
    }

    .login-card {
        width: 380px;
        background: rgba(255,255,255,0.14);
        backdrop-filter: blur(12px);
        border-radius: 15px;
        padding: 30px;
        color: white;
        box-shadow: 0 8px 25px rgba(0,0,0,0.4);
        animation: fadeIn 0.8s ease-in-out;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to   { opacity: 1; transform: translateY(0); }
    }

    .sgi-logo {
        width: 90px;
        display: block;
        margin: 0 auto 20px;
        filter: drop-shadow(0 0 6px rgba(0,0,0,0.5));
    }

    .form-control {
        background: rgba(255,255,255,0.25);
        border: none;
        color: white !important;
    }

    .form-control::placeholder {
        color: #eee;
    }

    .form-control:focus {
        background: rgba(255,255,255,0.35);
        color: white;
        box-shadow: none;
    }

    .btn-login {
        background-color: #0d6efd;
        border: none;
        font-weight: bold;
        padding: 10px 0;
    }

    .btn-login:hover {
        background-color: #0a57d0;
    }

    .error-alert {
        margin-top: 10px;
        background: rgba(255, 0, 0, 0.25);
        border-left: 4px solid #ff3b3b;
        padding: 10px;
        border-radius: 5px;
        display: none;
    }
</style>
</head>

<body>

<!-- üé• VIDEO DE FONDO -->
<video autoplay muted loop id="videoBG">
    <source src="Video Login.mp4" type="video/mp4">
</video>
<div class="overlay-dark"></div>

<div class="d-flex justify-content-center align-items-center h-100">
    <div class="login-card text-center">

        <img src="Captura de pantalla 2025-09-07 185933.png"
             class="sgi-logo">

        <h4 class="fw-bold mb-2">SGI ‚Äì Sistema de Gesti√≥n de Inscripciones</h4>
        <p class="text-white-50 mb-4">Acceso restringido</p>

        <div class="text-start mb-3">
            <label class="form-label">Usuario</label>
            <input id="user" type="text" class="form-control" placeholder="Ingres√° tu usuario">
        </div>

        <div class="text-start mb-3">
            <label class="form-label">Contrase√±a</label>
            <input id="pass" type="password" class="form-control" placeholder="Ingres√° tu contrase√±a">
        </div>

        <button id="btnLogin" class="btn btn-login w-100">INGRESAR</button>

        <div id="msg" class="error-alert">Usuario o contrase√±a incorrectos</div>

    </div>
</div>

<!-- ============================
     SGI API REAL (embaulado)
================================ -->
<script>
const SGI_API = {
    backend: "http://localhost:8080",

    async login(usuario, contrasena) {
        const res = await fetch(`${this.backend}/api/auth/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                username: usuario,
                password: contrasena
            })
        });

        if (!res.ok) {
            throw new Error("Credenciales incorrectas");
        }

        return await res.json();
    },

    async get(url) {
        const token = localStorage.getItem("token");

        const res = await fetch(`${this.backend}${url}`, {
            headers: { "Authorization": `Bearer ${token}` }
        });

        if (!res.ok) throw new Error("Error en GET");

        return await res.json();
    }
};
</script>

<!-- ==================================
     LOGIN REAL CON REDIRECCI√ìN POR ROL
====================================== -->
<script>
document.getElementById("btnLogin").addEventListener("click", async () => {
    const user = document.getElementById("user").value.trim();
    const pass = document.getElementById("pass").value.trim();
    const msg  = document.getElementById("msg");

    msg.style.display = "none";

    try {
        const data = await SGI_API.login(user, pass);

        // Guardamos token y rol
        localStorage.setItem("token", data.token);
        localStorage.setItem("usuario", data.username);
        localStorage.setItem("rol", data.role);

        // REDIRECCI√ìN REAL POR ROL
        switch (data.role) {
            case "ROLE_ADMIN":
            case "ROLE_JEFE":
                window.location.href = "jefes.html";
                break;

            case "ROLE_APROBADOR":
                window.location.href = "aprobadores.html";
                break;

            case "ROLE_ASPIRANTE":
                window.location.href = "aspirantes.html";
                break;

            default:
                msg.innerText = "Rol no reconocido.";
                msg.style.display = "block";
        }

    } catch (e) {
        msg.innerText = "Usuario o contrase√±a incorrectos";
        msg.style.display = "block";
    }
});
</script>

</body>
</html>
